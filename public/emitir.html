<html>
	<head>
		<title>hello</title>
 		<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
 		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<video src="" id="video" style="width:600px;height:800px;"> </video>
		<canvas  id="preview"  style="display:none;" > </canvas>

		<script type="text/javascript" >
		var canvas= document.getElementById('preview');
		var context = canvas.getContext( "2d");
		canvas.width=600;
		canvas.height= 800;
		context.width=600;
		context.height= 800;
		var video= document.getElementById('video');
		var socket =io();

		function loadCam(stream){
			video.src=window.URL.createObjectURL(stream);
		};
		function loadFail(){
			console.log('error camara');
		};

		function viewVideo(video, context){
			context.drawImage(video, 0 , 0, context.width, context.height);
			socket.emit('stream', {url : canvas.toDataURL('image/webp')});
		};

		$(function(){

			navigator.getUserMedia= (navigator.getUserMedia ||navigator.webkitGetUserMedia || navigator.mozGetUserMedia);

			if(navigator.getUserMedia){
					navigator.getUserMedia({video:true}, loadCam, loadFail);
			}

			setInterval(function(){viewVideo(video, context)},70);
		});

		</script>
	</body>

</html>